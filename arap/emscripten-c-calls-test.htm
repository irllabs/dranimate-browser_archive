<script src="arap-test.js"></script>

<script>
setupMesh = Module.cwrap('setupMesh','[null]')
setupMesh();

/*
// Import function from Emscripten generated file
float_multiply_array = Module.cwrap(
  'float_multiply_array', 'number', ['number', 'number', 'number']
);

// Create example data to test float_multiply_array
var data = new Float32Array([1, 2, 3, 4, 5]);
console.log(data)

// Get data byte size, allocate memory on Emscripten heap, and get pointer
var nDataBytes = data.length * data.BYTES_PER_ELEMENT;
var dataPtr = Module._malloc(nDataBytes);

// Copy data to Emscripten heap (directly accessed from Module.HEAPU8)
var dataHeap = new Uint8Array(Module.HEAPU8.buffer, dataPtr, nDataBytes);
dataHeap.set(new Uint8Array(data.buffer));

// Call function and get result
float_multiply_array(2, dataHeap.byteOffset, data.length);
var result = new Float32Array(dataHeap.buffer, dataHeap.byteOffset, data.length);

// Free memory
Module._free(dataHeap.byteOffset);
*/

setMeshVertexData = Module.cwrap(
  'setMeshVertexData', 'number', ['number', 'number']
);
getMeshVertexData = Module.cwrap(
  'getMeshVertexData', 'number', ['number', 'number']
);
resetMesh = Module.cwrap(
  'resetMesh', 'number', ['number', 'number']
);

function doArrayFunction(arr, func) {
	// Create data
	var data = new Float32Array(arr);
	console.log(data)

	// Get data byte size, allocate memory on Emscripten heap, and get pointer
	var nDataBytes = data.length * data.BYTES_PER_ELEMENT;
	var dataPtr = Module._malloc(nDataBytes);

	// Copy data to Emscripten heap (directly accessed from Module.HEAPU8)
	var dataHeap = new Uint8Array(Module.HEAPU8.buffer, dataPtr, nDataBytes);
	dataHeap.set(new Uint8Array(data.buffer));

	// Call function and get result
	func(dataHeap.byteOffset, data.length);
	var result = new Float32Array(dataHeap.buffer, dataHeap.byteOffset, data.length);

	// Free memory
	Module._free(dataHeap.byteOffset);

	// print da thing (remove this)
	console.log(result);

	return result;
}

resetMesh();

doArrayFunction([1, 2, 3, 4, 5, 6], setMeshVertexData);
doArrayFunction([0, 0, 0, 0, 0, 0], getMeshVertexData);

</script>